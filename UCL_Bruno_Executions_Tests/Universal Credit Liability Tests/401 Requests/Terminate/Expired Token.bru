meta {
  name: Expired Token
  type: http
  seq: 3
}

post {
  url: {{api-host}}/notification
  body: json
  auth: none
}

headers {
  Content-Type: application/json
  correlationId: {{$randomUUID}}
  gov-uk-originator-id: {{govUkOriginatorId}}
}

body:json {
  {
    "nationalInsuranceNumber": "{{nino}}",
    "universalCreditRecordType": "UC",
    "universalCreditAction": "Terminate",
    "liabilityStartDate": "2025-08-19",
    "liabilityEndDate": "2025-01-04"
  }
}

script:pre-request {
  const token = bru.getVar('expiredToken');

  if (!token) {
    throw new Error("No token found. Please run the 'Setup - Get Expired Token' request first.");
  }

  console.log("Waiting 2 seconds for token to expire...");
  await new Promise(r => setTimeout(r, 2000));

  req.setHeader('Authorization', token);
}

assert {
  res.status: eq 401
  res.body.code: eq 'UNAUTHORIZED'
  res.body.message: eq 'Session record not found'
}
